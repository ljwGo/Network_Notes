[toc]

# 数据链路层基本功能

> 数据链路层提供**网络节点**到**相邻网络节点**的通信服务
>
> 类似快递车行驶的**车道**
>
> *概述基本功能：*<u>组帧</u>、<u>差错控制</u>、<u>可靠交付</u>（多用于出错率高的链路）、<u>链路接入</u>

## 链路类型

1. 点对点链路

2. 广播链路

   ![广播链路](D:\Notes\计算机网络\数据链路层\2021-11-21_171633.png)
   
   > 广播链路，A与B通信的信号，**也会发送给主机C、D、E**

# 差错控制

> *差错控制的四种方式：*<u>检错重发</u>、<u>前向纠错</u>、<u>反馈校验</u>、<u>检错丢弃</u>
>
> ​	*前向纠错：*接收到识别数据出现错误时，能够**识别错误所在并且纠错**
>
> ​	*反馈校验：*将接收数据**原封不动**发送给发送节点

## 检错的几种方式

1. ## 奇偶效验码

   > 在真正的数据后添加一位校验位
   >
   > ​	*奇数校验码：*保证真正数据中**1的个数**为**奇数**
   >
   > ​	比如：0101 + 1，0111 + 0
   >
   > ​	*偶数校验码：*保证真正数据中**1的个数**为**偶数**
   >
   > ​	比如：0101 + 0，0111 + 1

   奇偶校验码有一个**很大弊端**，就是数据发生改变的地方**不止一处，而是多处**，就可能检测不出错误

   > 比如对于奇数效验码：11001 变为 00001，改变后的数据人满足1的个数为奇数，错误无法排查

   

2. ## 汉明编码（具体的实现还是不太懂, 再看一次明白了）

   ![汉明编码](D:\Notes\计算机网络\数据链路层\2021-11-17_223201.png)

   汉明编码不仅能够检查出数据错误，还能精确地对**单个比特位的改错**

   汉明距离：

   > 汉明距离: 两个等长的码字之间相对应位不同的位数
   >
   > 比如<u>**101010**</u>和<u>**010101**</u>的汉明距离，不相同对应位数为6
   >
   > ​	101010
   >
   > ​	010101

   

   汉明编码集:

   > 对真正发送的数据进行编码
   >
   > 一般的编码规则为: **重复多次真正发送的数据**
   >
   > 比如数据为00, 就发送0000, 或者000000
   >
   > ​		数据为01, 就发送0101,或者010101
   >
   > 编码集:
   >
   > ​	对于**两位的数据**, 只有**四种排列顺序: 00 01 10 和 11**
   >
   > ​	如果应用重复一次的规则, 将得到一个**编码集: 0000 0101 1010 1111(该编码集是固定唯一的)**

   

   汉明编码集的汉明距离:

   > 汉明编码集的汉明距离, 指的是**任意两个码字之间的对应位不同位数的最小值**
   >
   > 比如0000 0101 1010 1111编码集的汉明距离为2

   

   汉明编码功能

   > 能根据汉明距离得到的**检测错误位数r**
   >
   > ​	r = d - 1
   >
   > 更够**纠正的错误位数c**
   >
   > ​	c = (d - 1) / 2

   

   就视频中的例子

   > {000000，010101，101010，111111}的汉明编码
   >
   > 两两比较之后，得到**汉明距离d=3**
   >
   > 其中**101010数据变为101011**
   >
   > 发现101011
   >
   > 和000000的汉明距离为4，
   >
   > 和010101的汉明距离为5，
   >
   > 和101010的汉明距离为1，
   >
   > 和111111的汉明距离为2，
   >
   > 那么101011**极可能原本是101010**

   

   **关于汉明距离的一些问题**

   > 1. 如何确保汉明编码发送时，本身不发生错误 (**不需要发送**)
   >
   > 2. 发送的汉明编码集不视为数据，真正的数据需要对照汉明编码集, (**汉明编码集的选用是链路两端提前约定好,毕竟链路层纠错,只用在频发出现错误的地方**)
   >
   > 3. 正真需要发送的数据为00，则汉明编码可以为
   >
   >    0000或000000或00000000，是真正发送数据的重复

   **自己的一点思考**

   > 之所以汉明编码是重复发送数据的重复，原因在于是
   >
   > **发送方将同一份数据发送多次**或是**发送方将同一份数据按x位分割重复n遍后发送**
   >
   > 比如{000000，010101，101010，111111}
   >
   > 就可能是**00，01，10，11连续发送3次**，接收节点接收后处理判断
   >
   > 或是发送端将**00，01，10，11**变更为**000000，010101，101010，111111**后发送，
   >
   > 接收节点根据**事先商量好**的**x**和**n**进行分割
   >
   > 我更倾向与后者：理由是重复发送4次占用太多资源
   >
   > 汉明编码集本身出现错误时，依据**少数服从多数**的办法判断原本数据
   >
   > **010100**中01出现两次，00出现一次，则汉明编码原本更可能是010101

   **后续**

   > 汉明码需要发送很多重复数据, 并且只有前面两个字节是真正的数据

   

1. ## 循环冗余码CRC

   > 循环冗余码能够快速的发现错误，并且不像汉明编码需要附加很多数据

   *CRC规则*

   > 会有一个通信双方提前约定好的转换公式：该公式的特点是**由0或1与x的几次幂的乘积为项的总和**
   >
   > 比如：G(x) = x^4^ + x^2^ + 1
   >
   > 本质为 1 * x^4^ + 0 * x^3^ + 1 * x^2^ + 0 * x^1^ + 1 * x^0^
   >
   > 这个公式是能够转换为**比特位形式的**
   >
   > 上面的**G(x)就能够表示为10101（根据本质中每一项的常数项值）**
   >
   > 类似md5，将真正数据进过处理得到一个**信息摘要**，拼接到真正数据的尾部
   >
   > 比如对于G(x)的公式，信息摘要位数为4
   >
   > 信息摘要通过
   >
   > <u>**（真正数据后面补公式最高位幂个数的0）% 公示的比特位形式 **</u>
   >
   > *注意：*
   >
   > ​	二进制除法，满位即可除
   >
   > ​	0除1为1，
   >
   > ​	1除0为1，
   >
   > ​	0除0 和 1除1结果都为0
   >
   > 比如
   >
   > ​	10010除
   >
   > ​	10110得
   >
   > ​    可除,得100

![CRC循环冗余码](D:\Notes\计算机网络\数据链路层\2021-11-17_232617.png)

# 多路访问控制协议

![信道划分MAC协议](D:\Notes\计算机网络\数据链路层\2021-11-18_111254.png)

> 对于频分多路复用，带宽比较大的信道才利于使用

疑惑:

> 频分到底是频率分割还是啥



1. ## ALOHA协议

   *纯ALOHA协议：*

   > 发送端直接**发送数据**，发送后**进行监听**，监听到**数据发生碰撞后重发**
   >
   > 纯ALOHA协议就是大家争抢着用，抢不到就重新抢

   *时隙ALOHA协议：*

   > 每个时隙t内，**只发送一次**数据，如果发生检测到碰撞，则只能**在下一个时隙以概率P发送数据**

   

2. ## CSMA载波多路访问控制协议

   与ALOHA协议很不同的一点，CSMA协议规定**先监听**，监听到**信道空闲时发送数据**

   

   坚持CSMA协议

   > **持续监听**，如果发现信道被占用，则继续继续监听
   >
   > 坚持CSMA协议的问题是，当一个网络的主机比较多时。
   >
   > 同时有**多个主机在监听信道**，信道一旦空闲，它们几乎同时监听到信道空闲，
   >
   > 几乎同时发送数据，就很容易发生数据碰撞

   非坚持CSMA协议

   > **间断监听**，如果发现信道被占用，则等待一段时间后再继续监听
   >
   > 非坚持CSMA协议的问题是，信道利用率会降低.

   P概率CSMA协议

   > 在非坚持CSMA协议的基础上，等待一段时间并监听信道空闲，**以概率P发送数据**

   

   *三者总结：*

   > 坚持CSMA协议适用于较小网络或是不频繁通信的网络，信道利用率最高
   >
   > 非坚持CSMA适用于较大网络，信道利用率次之
   >
   > P概率CSMA协议适用于更大网络，信道利用率三者最低

   **带碰撞检测的CSMA/CD协议**

   > 就是先监听信道空闲，空闲则发送数据，发送数据时监听信道

   

3. ## 接入模式（粗略了解）

   ![接入模式MAC协议](D:\Notes\计算机网络\数据链路层\2021-11-18_111357.png)

> *轮叫轮询：*统一调度主机A->B，A->C，A->D
>
> *传递轮询：*A->B，B->C，C->D
>
> *令牌技术：*多用于环形网络

# 局域网

1. ## 以太网

   ![以太网](D:\Notes\计算机网络\数据链路层\2021-11-18_111510.png)

   > *10Base-5：*传输速率为10Mbps，采用基带传输，传输距离为500米
   >
   > *10Base-5：*传输速率为10Mbps，采用基带传输，使用同轴电缆
   >
   > *100Base-T：*传输速率为100Mbps，采用基带传输，使用双绞线
   >
   > *100Base-T：*传输速率为100Mbps，采用基带传输，使用光纤

   

2. ## 交换机以太网

   > 由于碰撞的发生，传统的以太网规模不能太大。
   >
   > 交换机能够进行调度控制，避免碰撞

   ![交换机](D:\Notes\计算机网络\数据链路层\2021-11-20_100737.png)

   > *关于自学习：*
   >
   > ​	简单地说，**主机A发送的数据帧**中，含有**A自身的MAC地址**，
   >
   > ​	该数据帧需要经过交换机转交，交换机收到数据帧后
   >
   > ​	将数据帧中的**源MAC地址和端口号**对应，**存储到交换表**中
   >
   > *消除冲突：*
   >
   > ​	A要与B通信，那么A发送的数据帧经由交换机只发送给B
   >
   > ​	信号就不会到达3，4链路中，自然不会发生碰撞

   

   **关于交换机的思考**

   > 如果A与B通信中，此时C想与B进行通信，
   >
   > 那么2链路是被占用的，C与B就不能进行通信，
   >
   > 那么交换机理应能够将C与B通信的**数据缓存下来**
   >
   > 待2链路空闲时，再将数据发送给B

   

3. ## MAC地址与ARP协议

   ![MAC地址与ARP协议](D:\Notes\计算机网络\数据链路层\2021-11-18_111442.png)

   >MAC地址**前24位表示生产厂家**，也就是说同一厂家生产的网络接口设备，其MAC地址前24位都是一样的
   >
   >*地址解析协议ARP出现理由：*
   >
   >​	外网的某个主机A想要访问内网的某个主机B，
   >
   >​	**A只知道B的IP地址，而不知道其MAC地址**，
   >
   >​	但是内网（以太网）进行**通信查询和身份识别**的依据是**MAC地址，而非IP地址**
   >
   >​	于是需要一种**IP转换为MAC地址**的方法
   >
   >​	就是ARP协议
   >
   >*ARP：*
   >
   >​	说白了就是进行广播，给内网内每台主机都发送询问，
   >
   >​	只有IP地址相同的会做出相应，将MAC地址告诉默认网关

   

   **关于MAC地址的思考**

   > MAC地址是全球唯一的，那为何不是用**MAC地址+端口号**确定世界上任意一个应用进程，而是使用**IP地址+端口号**
   >
   > 可能的有两点：
   >
   > ​	一是——MAC地址前24位表示厂商，同一厂商生产的产品**遍布全球**；但是**IP地址可以划分子网**
   >
   > ​	二是——IP地址是**虚拟网络协议**，是构筑在各个不同网络之上的**通用上层协议**

   

4. ## VLAN虚拟局域网

   ![VLAN虚拟局域网](D:\Notes\计算机网络\数据链路层\2021-11-18_111645.png)

> 可以划分VLAN虚拟局域网，这种划分不局限于地理位置
>
> ​	比如A~1~，A~2~，A~3~是同属于一个分组，那么它们之间可以互相传输数据；
>
> ​	但是不在分组的B~1~就无法访问A~1~，A~2~和A~3~

# HDLC协议

![](D:\Notes\计算机网络\数据链路层\2021-11-18_112537.png)

> *数据中连续出现6个1带来的冲突问题：*
>
> ​	如果**数据中连续出现5个1**，就在**后面添加一个0**，
>
> ​	接收方接收到数据帧后，对于**数据中连续出现的5个1**，
>
> ​	就会**默认删除后面的一个0，还原数据**

# 点对点链路协议

1. ## PPP协议

   ![PPP协议](D:\Notes\计算机网络\数据链路层\2021-11-18_111713.png)

> PPPoe——PPP协议的改良
>
> *链路控制协议LCP：*
>
> ​	负责控制链接的建立，拆除
>
> *网络控制协议NCP：*
>
> ​	负责协商IP协议，身份认证